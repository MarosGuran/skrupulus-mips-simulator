# Production Docker Compose configuration for MIPS Simulator
# This file demonstrates how to override authentication settings for production

services:
  mips-simulator:
    build:
      context: .
      dockerfile: Dockerfile
    image: skrupulus-mips-simulator:latest
    container_name: mips-simulator
    ports:
      # Use port 80 for production (requires running as root or with proper permissions)
      # Or use port 8080 and configure reverse proxy
      - "80:80"
    restart: unless-stopped
    # Mount custom .htpasswd file to override default credentials
    volumes:
      # Uncomment and customize the path to your .htpasswd file:
      # - ./custom.htpasswd:/etc/nginx/.htpasswd:ro
      
      # Optional: Mount custom nginx configuration if needed
      # - ./custom-nginx.conf:/etc/nginx/conf.d/default.conf:ro
    
    # Environment variables (if needed for future enhancements)
    # environment:
    #   - NGINX_HOST=mips.fiit.stuba.sk
    #   - NGINX_PORT=80
    
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    
    # Resource limits (adjust based on server capacity)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.5'
    #       memory: 256M

# Optional: Add logging configuration
# logging:
#   driver: "json-file"
#   options:
#     max-size: "10m"
#     max-file: "3"

# Networks (if needed for complex setups)
# networks:
#   default:
#     name: mips-network
