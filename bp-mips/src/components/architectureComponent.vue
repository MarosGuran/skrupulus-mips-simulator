<template>
  <div class="architecture-container">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="95.091 75.685 668.512 325.018" xmlns:bx="https://boxy-svg.com">
      <rect x="110" y="120" width="20" height="250" style="fill: #1976D2; stroke: rgb(0, 0, 0);" rx="4" ry="4"/>
      <rect x="240" y="120" width="20" height="250" style="fill: #1976D2; stroke: rgb(0, 0, 0);" rx="4" ry="4"/>
      <rect x="384.621" y="120" width="20" height="250" style="fill: #1976D2; stroke: rgb(0, 0, 0);" rx="4" ry="4"/>
      <rect x="570.403" y="120.096" width="20" height="250" style="fill: #1976D2; stroke: rgb(0, 0, 0);" rx="4" ry="4"/>
      <rect x="701.614" y="120.096" width="20" height="250" style="fill: #1976D2; stroke: rgb(0, 0, 0);" rx="4" ry="4"/>
      <path style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 503.82 234.383 L 528.82 255.951 L 528.82 299.087 L 503.82 320.655 L 503.82 288.303 L 513.82 277.519 L 503.82 266.735 L 503.82 234.383 Z"/>
      <path style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 191.471 150.144 L 207.063 164.461 L 207.063 193.093 L 191.471 207.409 L 191.471 185.935 L 197.708 178.777 L 191.471 171.619 L 191.471 150.144 Z"/>
      <path style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 486.582 149.376 L 502.174 163.693 L 502.174 192.325 L 486.582 206.641 L 486.582 185.167 L 492.819 178.009 L 486.582 170.851 L 486.582 149.376 Z"/>
      <rect x="171.828" y="253.735" width="50.959" height="72.911" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="175.994" y="299.62" transform="matrix(0.324015, 0, 0, 0.350992, 116.733, 188.636)">Instructions</text>
      <rect x="322.803" y="223.836" width="50.959" height="72.911" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="175.994" y="299.62" transform="matrix(0.324015, 0, 0, 0.350992, 274.214, 158.961)">Register</text>
      <rect x="630.626" y="224.207" width="50.959" height="72.911" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="175.994" y="299.62" transform="matrix(0.324015, 0, 0, 0.350992, 589.138, 159.332)">Data</text>
      <ellipse style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" cx="314.193" cy="127.727" rx="9.571" ry="17.178"/>
      <rect x="355.58" y="121.093" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="309.356" y="126.339" transform="matrix(0.2204, 0, 0, 0.249431, 241.577, 99.3408)">CU</text>
      <rect x="345.625" y="141.703" width="9.701" height="2" style=""/>
      <rect x="546.698" y="129.951" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <rect x="551.641" y="150.904" width="9.701" height="2" style="" transform="matrix(1, 0, 0, 1, -15.0549, 0.095891)"/>
      <rect x="423.318" y="333.328" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <rect x="469.678" y="290.093" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <rect x="740.551" y="253.11" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <rect x="653.074" y="92.044" width="12.27" height="27.485" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" rx="3.391" ry="3.391"/>
      <g class="memory-stage" :style="getMemoryStyle()">
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 218.154, -98.6238)"/>
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 409.272, -89.7653)"/>
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 515.648, -127.671)"/>
        <rect x="590.565" y="348.747" width="111.016" height="2" style=""/>
        <rect x="54.125" y="31498.8" width="1" height="101.094"  transform="matrix(1, 0, 0, 1, 583.517, -31410.8)"/>
        <rect x="-248.71" y="-13.03" width="7.994" height="1" style="" transform="matrix(-1, 0, 0, -1, 389.396, 176.06)"/>
        <rect x="-676.43" y="-88.195" width="21.469" height="1" style="" transform="matrix(-1, 0, 0, -1, -17.3138, 0)"/>
        <rect x="26.575" y="1196" width="1" height="3.838"  transform="matrix(-1, 0, 0, 1, 685.712002, -1108.28)"/>
        <rect x="248.69" y="105.367" width="389.142" height="1" style=""/>
        <rect x="-28.375" y="-4419.3" width="1" height="14.183"  transform="matrix(-1, 0, 0, 1, 221.316, 4524.729106)"/>
        <rect x="26.575" y="7399.4" width="1" height="23.745"  transform="matrix(-1, 0, 0, 1, 579.449002, -7293.689805)"/>
        <rect x="-26.575" y="-4661.1" width="1" height="14.957"  transform="matrix(-1, 0, 0, 1, 335.285998, 4766.769766)"/>
        <rect x="-941.52" y="-197.16" width="27.976" height="1" style="" transform="matrix(-1, 0, 0, -1, -322.566, 0.095891)"/>
        <rect x="590.617" y="145.854" width="110.992" height="2" style=""/>
        <rect x="-26.779" y="-11678" width="1" height="38.021"  transform="matrix(-1, 0, 0, 1, 584.775001, 11824.399219)"/>
        <rect x="51.179" y="24118" width="1" height="77.404"  transform="matrix(1, 0, 0, 1, 604.783, -23971.9)"/>
        <rect x="-26.779" y="-3771.6" width="1" height="12.105"  transform="matrix(-1, 0, 0, 1, 628.581001, 4069.030234)"/>
        <rect x="-1229.5" y="-197.16" width="36.538" height="1" style="" transform="matrix(-1, 0, 0, -1, -538.105, 112.375)"/>
        <rect x="590.246" y="177.367" width="12.154" height="2" style=""/>
        <rect x="600.414" y="114.205" width="2" height="64.166" style=""/>
        <rect x="600.463" y="113.296" width="52.265" height="2" style=""/>
        <rect x="590.563" y="328.226" width="30.143" height="2" style=""/>
        <rect x="619.887" y="289.923" width="2" height="40.3" style=""/>
        <rect x="238.84" y="277.698" width="15.057" height="2" style="" transform="matrix(1, 0, 0, 1, 351.575, 0)"/>
        <rect x="604.881" y="246.872" width="2" height="73.166" style=""/>
        <rect x="1887.26" y="328.226" width="96.328" height="2" style="" transform="matrix(1, 0, 0, 1, -1282.26, -10.1898)"/>
        <rect x="605.136" y="263.29" width="25.122" height="2" style=""/>
        <rect x="115.7" y="50854.6" width="1" height="163.21"  transform="matrix(-1, 0, 0, 1, 807.088994, -50708.70916)"/>
        <rect x="1485.28" y="246.861" width="25.334" height="2" style="" transform="matrix(1, 0, 0, 1, -880.199, 0)"/>
        <rect x="383.568" y="328.226" width="19.578" height="2" style="" transform="matrix(1, 0, 0, 1, 298.133, -68.4808)"/>
        <rect x="-619.04" y="-184.43" width="7.994" height="1" style="" transform="matrix(-1, 0, 0, -1, 0, 0)"/>
        <rect x="202.163" y="328.226" width="10.319" height="2" style="" transform="matrix(1, 0, 0, 1, 417.982, -38.2945)"/>
      </g>
      <g class="execute-stage" :style="getExecuteStyle()">
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 285.892, 113.612)"/>
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 332.252, 70.3775)"/>
        <rect x="419.889" y="340.423" width="18.082" height="2" style="" transform="matrix(1, 0, 0, 1, -15.0549, 0.095891)"/>
        <rect x="419.889" y="340.423" width="18.082" height="2" style="" transform="matrix(1, 0, 0, 1, -15.0903, 13.4957)"/>
        <rect x="435.842" y="348.793" width="134.467" height="2" style=""/>
        <rect x="21.424" y="60851.1" width="1" height="195.301"  transform="matrix(1, 0, 0, 1, 407.589, -60713.6)"/>
        <rect x="405.007" y="319.954" width="50.675" height="2" style=""/>
        <rect x="21.424" y="47382.6" width="1" height="152.075"  transform="matrix(1, 0, 0, 1, 454.487, -47245)"/>
        <rect x="404.912" y="136.612" width="141.582" height="2" style=""/>
        <rect x="453.676" y="193.988" width="2" height="126.385" style=""/>
        <rect x="454.035" y="193.991" width="32.569" height="2" style=""/>
        <rect x="212.015" y="310.421" width="15.275" height="2" style="" transform="matrix(1, 0, 0, 1, 242.272, 0.095891)"/>
        <rect x="405.098" y="279.09" width="37.221" height="2" style=""/>
        <rect x="441.378" y="279.088" width="2" height="51.093" style=""/>
        <rect x="457.061" y="296.708" width="27.435" height="2" style="" transform="matrix(1, 0, 0, 1, -15.0549, 0.095891)"/>
        <rect x="715.796" y="305.333" width="22.007" height="2" style="" transform="matrix(1, 0, 0, 1, -234.03, 0.095891)"/>
        <rect x="405.016" y="245.626" width="82.162" height="2" style=""/>
        <rect x="485.175" y="252.27" width="18.655" height="2" style=""/>
        <rect x="1162.87" y="67.417" width="2" height="7.526" style="" transform="matrix(1, 0, 0, 1, -677.694, 178.86)"/>
        <rect x="-591.05" y="-13.03" width="18.997" height="1" style="" transform="matrix(-1, 0, 0, -1, -42.829, 255.673)"/>
        <rect x="-15.294" y="-22468" width="1" height="72.107"  transform="matrix(1, 0, 0, 1, 563.047, 22664.6)"/>
        <rect x="-688.33" y="-13.03" width="22.124" height="1" style="" transform="matrix(-1, 0, 0, -1, -118.36, 184.063)"/>
        <rect x="516.903" y="136.947" width="2" height="109.334" style=""/>
        <rect x="404.733" y="178.986" width="49.662" height="2" style=""/>
        <rect x="1224.06" y="14.828" width="2" height="18.02" style="" transform="matrix(1, 0, 0, 1, -771.67, 147.115)"/>
        <rect x="452.39" y="161.621" width="34.108" height="2" style=""/>
        <rect x="502.276" y="177.385" width="67.901" height="2" style=""/>
        <rect x="441.644" y="328.174" width="128.683" height="2" style=""/>
        <rect x="559.053" y="145.412" width="11.415" height="2" style=""/>
        <rect x="587.819" y="259.449" width="41.369" height="2" style="" transform="matrix(1, 0, 0, 1, -58.9353, 18.0441)"/>
      </g>
      <g class="fetch-stage" :style="getFetchStyle()">
        <rect x="223.288" y="291.598" width="16.654" height="2" style=""/>
        <rect x="147.661" y="161.521" width="43.376" height="2" style=""/>
        <rect x="207.371" y="178.755" width="32.658" height="2" style=""/>
        <rect x="87.814" y="24912.7" width="2" height="79.957" style="" transform="matrix(1, 0, 0, 1, 134.765, -24813.7)"/>
        <rect x="222.584" y="98.818" width="430.486" height="2" style=""/>
        <rect x="130.181" y="290.771" width="41.453" height="2" style=""/>
        <rect x="87.814" y="40111.1" width="2" height="128.738" style="" transform="matrix(1, 0, 0, 1, 59.8538, -39948.9)"/>
        <rect x="665.311" y="107.673" width="10.831" height="2" style=""/>
        <rect x="675.169" y="78.449" width="2" height="31.206" style=""/>
        <rect x="99.044" y="78.442" width="576.989" height="2" style=""/>
        <rect x="27.24" y="66332.2" width="2" height="212.894" style="" transform="matrix(1, 0, 0, 1, 71.8096, -66253.5)"/>
        <rect x="99.054" y="290.618" width="11.031" height="2" style=""/>
      </g>
      <rect x="619.377" y="179.711" width="10.278" height="19.529" style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="521.2" y="258.227" transform="matrix(0.369405, 0, 0, 0.375, 315.534, 167.512)">Alu</text>

      <g class="decode-stage" :style="getDecodeStyle()">
        <rect x="324.003" y="127.481" width="31.632" height="2" style=""/>
        <rect x="27.24" y="70508.1" width="2" height="226.296" style="" transform="matrix(1, 0, 0, 1, 249.128, -70380.2)"/>
        <rect x="276.368" y="127.394" width="28.203" height="2" style=""/>
        <rect x="259.774" y="291.594" width="17.012" height="2" style=""/>
        <rect x="359.667" y="136.513" width="16.305" height="2" style="" transform="matrix(1, 0, 0, 1, 8.43316, 0.055481)"/>
        <rect x="276.774" y="340.422" width="107.57" height="2" style=""/>
        <rect x="276.919" y="319.823" width="107.585" height="2" style=""/>
        <rect x="276.347" y="353.819" width="108.061" height="2" style=""/>
        <rect x="277.047" y="252.972" width="45.654" height="2" style=""/>
        <rect x="277.173" y="234.41" width="45.654" height="2" style=""/>
        <rect x="374.067" y="278.647" width="10.519" height="2" style=""/>
        <rect x="373.952" y="244.962" width="10.568" height="2" style=""/>
        <rect x="260.124" y="179.026" width="124.363" height="2" style=""/>
      </g>
      <g class="writeback-stage" :style="getWritebackStyle()">
        <rect x="172.151" y="97.369" width="15.316" height="2" style="" transform="matrix(0.797396, 0.603456, 0, 1.254082, 603.125, 33.3942)"/>
        <rect x="766.171" y="349.191" width="2" height="47.685" style="" transform="matrix(1, 0, 0, 1, -33.3312, -0.442782)"/>
        <rect x="291.066" y="395.749" width="443.774" height="2" style=""/>
        <rect x="291.066" y="273.15" width="2" height="123.181" style=""/>
        <rect x="291.065" y="272.918" width="31.526" height="2" style=""/>
        <rect x="723.205" y="150.904" width="12.719" height="2" style="" transform="matrix(1, 0, 0, 1, -1.52028, 197.842)"/>
        <rect x="32.935" y="43676.4" width="1" height="140.178"  transform="matrix(1, 0, 0, 1, 302.576, -43593.1)"/>
        <rect x="335.508" y="83.115" width="411.315" height="1" style=""/>
        <rect x="32.935" y="52647.5" width="1" height="170.172"  transform="matrix(1, 0, 0, 1, 713.39, -52564.4)"/>
        <rect x="721.926" y="259.806" width="18.387" height="2" style=""/>
        <rect x="721.899" y="318.429" width="9.233" height="2" style=""/>
        <rect x="730.003" y="271.639" width="2" height="47.632" style="" transform="matrix(1, 0, 0, 1, -0.861751, -0.205179)"/>
        <rect x="433.8" y="259.806" width="11.049" height="2" style="" transform="matrix(1, 0, 0, 1, 295.679, 11.6341)"/>
        <rect x="721.683" y="145.984" width="24.93" height="2" style=""/>
        <rect x="498.803" y="150.904" width="8.772" height="2" style="" transform="matrix(1, 0, 0, 1, 254.109, 117.929)"/>
        <rect x="760.208" y="268.838" width="2" height="112.926" style=""/>
        <rect x="308.064" y="379.771" width="453.784" height="2" style=""/>
        <rect x="308.069" y="287.337" width="2" height="93.433" style=""/>
        <rect x="308.06" y="287.084" width="14.815" height="2" style=""/>
      </g>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="197.434" y="166.539" transform="matrix(0.358101, 0, 0, 0.322275, 125.55, 118.059)">+</text>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="197.434" y="166.539" transform="matrix(0.358101, 0, 0, 0.322275, 419.988, 115.673)">+</text>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="341.404" y="142.463" transform="matrix(0.414242, 0, 0, 0.404368, 29.832, 146.154)">4</text>
      <rect x="178.745" y="199.389" width="12.729" height="2" style=""/>
      <ellipse cx="148.715" cy="291.715" rx="2.402" ry="2.341" style=""/>
      <ellipse style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" cx="361.62" cy="320.067" rx="5.843" ry="10.564"/>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="341.404" y="142.463" transform="matrix(0.414242, 0, 0, 0.404368, 197.041, 89.0139)">0</text>
      <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="341.404" y="142.463" transform="matrix(0.414242, 0, 0, 0.404368, 387.276, 98.11)">0</text>
      <ellipse cx="223.636" cy="179.634" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="277.361" cy="235.372" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="277.402" cy="254.028" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="277.296" cy="292.55" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="277.401" cy="320.814" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="277.311" cy="341.465" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="361.346" cy="105.879" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="442.383" cy="297.836" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="454.696" cy="311.501" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="517.937" cy="137.596" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="429.411" cy="137.565" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="476.367" cy="137.602" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="552.328" cy="105.948" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="638.051" cy="105.831" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="611.041" cy="146.878" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="656.451" cy="146.847" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="690.912" cy="146.879" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="746.769" cy="146.924" rx="1.926" ry="1.85" style=""/>
      <ellipse cx="605.847" cy="278.635" rx="2.402" ry="2.341" style=""/>
      <ellipse cx="605.864" cy="264.286" rx="2.402" ry="2.341" style=""/>
    </svg>
  </div>
</template>

<script lang="ts">
import { defineComponent } from 'vue';
import { usePipelineStore } from 'src/stores/pipelineStore';

export default defineComponent({
  name: 'ArchitectureComponent',
  setup() {
    const pipelineStore = usePipelineStore();

    const getFetchStyle = () => {
      const color = pipelineStore.getStageColor(0);
      return color ? { color: color, strokeWidth: '2px' } : { color: '#ccc', strokeWidth: '1px' };
    };

    const getDecodeStyle = () => {
      const color = pipelineStore.getStageColor(1);
      return color ? { color: color, strokeWidth: '2px' } : { color: '#ccc', strokeWidth: '1px' };
    };

    const getExecuteStyle = () => {
      const color = pipelineStore.getStageColor(2);
      return color ? { color: color, strokeWidth: '2px' } : { color: '#ccc', strokeWidth: '1px' };
    };

    const getMemoryStyle = () => {
      const color = pipelineStore.getStageColor(3);
      return color ? { color: color, strokeWidth: '2px' } : { color: '#ccc', strokeWidth: '1px' };
    };

    const getWritebackStyle = () => {
      const color = pipelineStore.getStageColor(4);
      return color ? { color: color, strokeWidth: '2px' } : { color: '#ccc', strokeWidth: '1px' };
    };

    return {
      getFetchStyle,
      getDecodeStyle,
      getExecuteStyle,
      getMemoryStyle,
      getWritebackStyle
    };
  }
});
</script>

<style scoped>
.architecture-container {
  width: 100%;
  height: auto;
  margin-top: 20px;
}

g {
  transition: color 0.3s ease;
}

rect, path, line, polyline {
  stroke: none;
  fill: currentColor;
}
</style>
